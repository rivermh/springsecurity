<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      th:replace="~{layout/layout :: layout(content=~{::content})}">

<th:block th:fragment="content">

    <!-- 게시글 카드 -->
    <div class="card shadow-sm mb-4">
        <div class="card-body">

            <!-- 🔥 post 전용 root -->
            <div id="post-root" th:data-post-id="${post.id}">

                <!-- 제목 -->
                <h2 class="card-title mb-2" th:text="${post.title}"></h2>

                <!-- 작성자 / 날짜 -->
                <p class="text-muted small mb-3">
                    작성자 <strong th:text="${post.username}"></strong>
                    ·
                    <span th:text="${#temporals.format(post.createdAt, 'yyyy-MM-dd HH:mm')}"></span>
                </p>

                <hr>

                <!-- 내용 -->
                <div class="mb-4" th:text="${post.content}"></div>

                <!-- 수정 / 삭제 -->
                <div class="d-flex justify-content-end mb-3"
                     th:if="${loginUser != null}">
                    <th:block th:if="${loginUser.username == post.username}">
                        <a th:href="@{|/posts/${post.id}/edit|}"
                           class="btn btn-sm btn-outline-primary me-2">
                            수정
                        </a>

                        <form th:action="@{|/posts/${post.id}/delete|}"
                              method="post"
                              onsubmit="return confirm('정말 삭제하시겠습니까?')">
                            <button class="btn btn-sm btn-outline-danger">
                                삭제
                            </button>
                        </form>
                    </th:block>
                </div>

                <!-- 좋아요 -->
                <div class="mb-4">
                    <div th:if="${loginUser != null}">
                        <button id="like-btn" class="btn btn-outline-danger btn-sm">
                            ❤️ 좋아요
                        </button>
                        <span class="ms-2 badge bg-secondary"
                              id="like-count"
                              th:text="${post.likeCount}">
                        </span>
                    </div>

                    <div th:if="${loginUser == null}" class="text-muted small">
                        좋아요를 누르려면 로그인하세요.
                    </div>
                </div>

                <hr>

                <!-- 댓글 -->
                <h5 class="mb-3">댓글</h5>

                <!-- 댓글 목록 -->
                <div id="comment-list" class="mb-3"></div>
				<div id="comment-pagination" class="mt-3"></div>

                <!-- 댓글 작성 -->
                <div th:if="${loginUser != null}">
                    <form id="comment-form">
                        <textarea id="comment-content"
                                  class="form-control mb-2"
                                  rows="3"
                                  placeholder="댓글을 입력하세요"
                                  required></textarea>
                        <div class="text-end">
                            <button class="btn btn-primary btn-sm">
                                댓글 작성
                            </button>
                        </div>
                    </form>
                </div>

                <div th:if="${loginUser == null}" class="text-muted small">
                    댓글을 작성하려면 로그인하세요.
                </div>

                <hr>

                <!-- 목록 -->
                <a th:href="@{/posts}" class="btn btn-outline-secondary btn-sm">
                    목록으로
                </a>

            </div>
        </div>
    </div>

    <!-- JS -->
    <script th:src="@{/js/posts-detail.js}"></script>

</th:block>
</html>
