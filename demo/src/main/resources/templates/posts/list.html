<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
	th:replace="~{layout/layout :: layout(content=~{::content})}">

<th:block th:fragment="content">

	<!-- 상단 헤더 -->
	<div class="d-flex justify-content-between align-items-center mb-4">
		<h3 class="fw-bold mb-0">자유게시판</h3>

		<a sec:authorize="isAuthenticated()" th:href="@{/posts/new}"
			class="btn btn-primary"> 글쓰기 </a>
	</div>

	<!-- 검색 -->
	<form th:action="@{/posts}" method="get"
		class="row g-2 mb-3 justify-content-end">

		<!-- 정렬 -->
		<div class="col-auto">
			<select name="sortType" class="form-select">
				<option value="LATEST"
					th:selected="${sortType == null || sortType.name() == 'LATEST'}">
					최신순</option>
				<option value="OLDEST" th:selected="${sortType?.name() == 'OLDEST'}">
					오래된순</option>
				<option value="TITLE" th:selected="${sortType?.name() == 'TITLE'}">
					제목순</option>
			</select>
		</div>

		<!-- 검색 타입 -->
		<div class="col-auto">
			<select name="searchType" class="form-select">
				<option value="TITLE"
					th:selected="${searchType == null || searchType.name() == 'TITLE'}">
					제목</option>
				<option value="CONTENT"
					th:selected="${searchType?.name() == 'CONTENT'}">내용</option>
				<option value="AUTHOR"
					th:selected="${searchType?.name() == 'AUTHOR'}">작성자</option>
			</select>
		</div>

		<!-- 키워드 -->
		<div class="col-auto">
			<input type="text" name="keyword" class="form-control"
				placeholder="검색어 입력" th:value="${keyword}">
		</div>

		<div class="col-auto">
			<button type="submit" class="btn btn-outline-secondary">검색</button>
		</div>


	</form>

	<!-- 게시글 목록 -->
	<div class="card shadow-sm border-0">
		<div class="card-body p-0">

			<table class="table table-hover mb-0">
				<thead class="table-light">
					<tr>
						<th style="width: 10%">번호</th>
						<th>제목</th>
						<th style="width: 15%">작성자</th>
						<th style="width: 20%">작성일</th>
					</tr>
				</thead>

				<tbody>
					<tr th:each="post : ${posts}">
						<td th:text="${post.id}"></td>

						<td><a th:href="@{/posts/{id}(id=${post.id})}"
							th:text="${post.title}" class="fw-semibold text-decoration-none">
						</a></td>

						<td th:text="${post.user.username}"></td>

						<td
							th:text="${#temporals.format(post.createdAt, 'yyyy-MM-dd HH:mm')}"></td>
					</tr>

					<!-- 게시글 없을 때 -->
					<tr th:if="${#lists.isEmpty(posts)}">
						<td colspan="4" class="text-center text-muted py-4">아직 게시글이
							없습니다.</td>
					</tr>
				</tbody>
			</table>

		</div>
	</div>

<!-- 페이징 -->
<nav class="mt-4" th:if="${postPage.totalPages > 0}">
    <ul class="pagination justify-content-center">

        <!-- 이전 -->
        <li class="page-item"
            th:classappend="${postPage.first} ? 'disabled'">
            <a class="page-link"
               th:href="@{/posts(
                   page=${postPage.number - 1},
                   keyword=${keyword},
                   searchType=${searchType},
                   sortType=${sortType}
               )}">
                이전
            </a>
        </li>

        <!-- 페이지 번호 -->
        <li class="page-item"
            th:each="i : ${#numbers.sequence(0, postPage.totalPages - 1)}"
            th:classappend="${i == postPage.number} ? 'active'">
            <a class="page-link"
               th:href="@{/posts(
                   page=${i},
                   keyword=${keyword},
                   searchType=${searchType},
                   sortType=${sortType}
               )}"
               th:text="${i + 1}">
            </a>
        </li>

        <!-- 다음 -->
        <li class="page-item"
            th:classappend="${postPage.last} ? 'disabled'">
            <a class="page-link"
               th:href="@{/posts(
                   page=${postPage.number + 1},
                   keyword=${keyword},
                   searchType=${searchType},
                   sortType=${sortType}
               )}">
                다음
            </a>
        </li>

    </ul>
</nav>


</th:block>
</html>
