<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      th:replace="~{layout/layout :: layout}">


<th:block th:fragment="content">

	<div class="d-flex justify-content-between align-items-center mb-3">
		<h2 class="mb-0">자유게시판</h2>

		<!-- 로그인한 사용자만 글쓰기 -->
		<a sec:authorize="isAuthenticated()" th:href="@{/posts/new}"
			class="btn btn-primary"> 글쓰기 </a>
	</div>

	<table class="table table-hover shadow-sm">
		<thead class="table-dark">
			<tr>
				<th style="width: 10%">번호</th>
				<th>제목</th>
				<th style="width: 15%">작성자</th>
				<th style="width: 20%">작성일</th>
			</tr>
		</thead>
		<tbody>
			<tr th:each="post : ${posts}">
				<td th:text="${post.id}"></td>

				<td><a th:href="@{/posts/{id}(id=${post.id})}"
					th:text="${post.title}" class="text-decoration-none fw-semibold">
				</a></td>

				<td th:text="${post.user.username}"></td>

				<td
					th:text="${#temporals.format(post.createdAt, 'yyyy-MM-dd HH:mm')}"></td>
			</tr>

			<!-- 게시글 없을 때 -->
			<tr th:if="${#lists.isEmpty(posts)}">
				<td colspan="4" class="text-center text-muted py-4">아직 게시글이
					없습니다.</td>
			</tr>
		</tbody>
	</table>
	<!-- 페이징 -->
	<nav aria-label="Page navigation">
		<ul class="pagination justify-content-center">

			<!-- 이전 -->
			<li class="page-item" th:classappend="${postPage.first} ? 'disabled'">
				<a class="page-link"
				th:href="@{/posts(page=${postPage.first ? 0 : postPage.number - 1})}">
					이전 </a>
			</li>

			<li class="page-item"
				th:each="i : ${#numbers.sequence(
        T(java.lang.Math).max(0, postPage.number - 2),
        T(java.lang.Math).min(postPage.totalPages - 1, postPage.number + 2)
    )}"
				th:classappend="${i == postPage.number} ? 'active'"><a
				class="page-link" th:href="@{/posts(page=${i})}" th:text="${i + 1}">
			</a></li>


			<!-- 다음 -->
			<li class="page-item" th:classappend="${postPage.last} ? 'disabled'">
				<a class="page-link"
				th:href="@{/posts(page=${postPage.last ? postPage.totalPages - 1 : postPage.number + 1})}">
					다음 </a>
			</li>

		</ul>
	</nav>

</th:block>
</html>
